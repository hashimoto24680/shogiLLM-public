# 将棋盤の座標系

cshogiライブラリにおける座標系の定義をまとめる。

## 座標の対応関係

### 基本定義

| 項目 | 範囲 | 説明 |
|------|------|------|
| `file` | 0-8 | 筋（0=1筋, 8=9筋） |
| `rank` | 0-8 | 段（0=一段, 8=九段） |
| `square_index` | 0-80 | マスインデックス |

### 計算式

```python
# マスインデックスからfile/rankを計算
file = square_index // 9
rank = square_index % 9

# file/rankからマスインデックスを計算
square_index = file * 9 + rank

# 日本語表記（1-indexed）
筋 = file + 1  # 1-9
段 = rank + 1  # 一〜九
```

### cshogiの関数

```python
import cshogi

# マスインデックスからfile/rankを取得
file = cshogi.make_file(square_index)  # 0-8
rank = cshogi.make_rank(square_index)  # 0-8
```

## 座標対応表

```
       9   8   7   6   5   4   3   2   1  ← 筋（表示用）
      ─────────────────────────────────────
  一 │72 │63 │54 │45 │36 │27 │18 │ 9 │ 0 │  ← rank=0
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  二 │73 │64 │55 │46 │37 │28 │19 │10 │ 1 │  ← rank=1
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  三 │74 │65 │56 │47 │38 │29 │20 │11 │ 2 │  ← rank=2
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  四 │75 │66 │57 │48 │39 │30 │21 │12 │ 3 │  ← rank=3
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  五 │76 │67 │58 │49 │40 │31 │22 │13 │ 4 │  ← rank=4
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  六 │77 │68 │59 │50 │41 │32 │23 │14 │ 5 │  ← rank=5
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  七 │78 │69 │60 │51 │42 │33 │24 │15 │ 6 │  ← rank=6
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  八 │79 │70 │61 │52 │43 │34 │25 │16 │ 7 │  ← rank=7
      ├───┼───┼───┼───┼───┼───┼───┼───┼───┤
  九 │80 │71 │62 │53 │44 │35 │26 │17 │ 8 │  ← rank=8
      ─────────────────────────────────────
       ↑   ↑   ↑   ↑   ↑   ↑   ↑   ↑   ↑
      f=8 f=7 f=6 f=5 f=4 f=3 f=2 f=1 f=0
```

## 日本語座標との対応

| 日本語 | file | rank | index | USI | cshogi定数 |
|--------|------|------|-------|-----|------------|
| 1一 | 0 | 0 | 0 | 1a | A1 |
| 1二 | 0 | 1 | 1 | 1b | B1 |
| 1九 | 0 | 8 | 8 | 1i | I1 |
| 5五 | 4 | 4 | 40 | 5e | E5 |
| 7七 | 6 | 6 | 60 | 7g | G7 |
| 9一 | 8 | 0 | 72 | 9a | A9 |
| 9九 | 8 | 8 | 80 | 9i | I9 |

### cshogiの定数名（A1形式）

cshogiでは各マスに`[段のアルファベット][筋の数字]`形式の定数が定義されている。

```python
import cshogi

# 定数を使ってマスを指定
cshogi.A1  # = 0  (1一)
cshogi.E5  # = 40 (5五)
cshogi.G7  # = 60 (7七)
cshogi.I9  # = 80 (9九)

# 命名規則: [段][筋]
# 段: A=一, B=二, C=三, D=四, E=五, F=六, G=七, H=八, I=九
# 筋: 1-9
```

| 段 | アルファベット | 数字 |
|----|--------------|------|
| 一 | A | 0 |
| 二 | B | 1 |
| 三 | C | 2 |
| 四 | D | 3 |
| 五 | E | 4 |
| 六 | F | 5 |
| 七 | G | 6 |
| 八 | H | 7 |
| 九 | I | 8 |

**注意**: cshogiの定数名は`[段][筋]`の順（例: A1=1一）だが、SQUARE_NAMESは`[筋][段]`の順（例: "1a"=1一）。

## 変換ユーティリティ

座標変換関数は `src/utils/coordinates.py` に実装されている。

```python
from src.utils import (
    japanese_to_index,   # "7七" -> 60
    index_to_japanese,   # 60 -> "7七"
    usi_to_index,        # "7g" -> 60
    index_to_usi,        # 60 -> "7g"
    file_rank_to_index,  # (6, 6) -> 60
    index_to_file_rank,  # 60 -> (6, 6)
)
```

## 座標系の注意点

1. **cshogiの座標系はプログラム向け** - 0-indexed
2. **日本語座標は人間向け** - 1-indexed、段は漢数字
3. **USI形式** - 筋は1-9、段はa-i
4. **features1の座標** - dlshogiでは`[color][channel][file][rank]`形式で格納

## 初期配置のインデックス

### 先手（下側）
| 駒 | マス | インデックス |
|----|------|-------------|
| 玉 | 5九 | 44 |
| 飛 | 2八 | 16 |
| 角 | 8八 | 70 |
| 左金 | 4九 | 35 |
| 右金 | 6九 | 53 |

### 後手（上側）
| 駒 | マス | インデックス |
|----|------|-------------|
| 玉 | 5一 | 36 |
| 飛 | 8二 | 64 |
| 角 | 2二 | 10 |
| 左金 | 6一 | 45 |
| 右金 | 4一 | 27 |
